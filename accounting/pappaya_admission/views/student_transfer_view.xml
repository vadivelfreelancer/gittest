<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>
		
		<record id="view_pappaya_student_transfer_tree" model="ir.ui.view">
			<field name="name">pappaya.student.transfer.form</field>
			<field name="model">pappaya.student.transfer</field>
			<field name="priority" eval="8"/>
			<field name="arch" type="xml">
				<tree string="Student Transfer">
					<field name="school_id"/>
					<field name="transfer_type"/>
					<field name="pappaya_student_id"/>
					<field name="father_name"/>
					<field name="state" />
				</tree>
			</field>
		</record>

		<record id="view_pappaya_student_transfer_form" model="ir.ui.view">
			<field name="name">pappaya.student.transfer.form</field>
			<field name="model">pappaya.student.transfer</field>
			<field name="priority" eval="8" />
			<field name="arch" type="xml">
				<form string="Student Transfer" duplicate="0" delete="false">
					<header>
						<button name="transfer_request" type="object" class="oe_highlight" string="Request" attrs="{'invisible': [('state','!=','draft')]}"
								groups="pappaya_base.group_admission_admin,pappaya_base.hr_branch_accountants"/>

						<button name="transfer_approve" type="object" class="oe_highlight" string="Approve" attrs="{'invisible': [('state','!=','request')]}"
								groups="pappaya_base.group_admission_admin,pappaya_base.group_admission_revenue_operation_assistant,pappaya_base.group_admission_revenue_operation_head,pappaya_base.hr_deans,
										pappaya_base.hr_branch_accountants"/>

						<button name="transfer_reject" type="object" class="oe_highlight" string="Reject" attrs="{'invisible': [('state','!=','request')]}"
								groups="pappaya_base.group_admission_admin,pappaya_base.group_admission_revenue_operation_assistant,pappaya_base.group_admission_revenue_operation_head,pappaya_base.hr_deans"/>
						
						<button name="transfer_transfered" type="object" class="oe_highlight" string="Transfer" attrs="{'invisible': [('state','!=','approve')]}"
								groups="pappaya_base.group_admission_admin,pappaya_base.hr_branch_accountants"/>
						
<!-- 						<button name="create_refund" type="object" class="oe_highlight" string="Create Refund"
							attrs="{'invisible': ['|',('is_refund_created','=',True),('is_create_refund','=',False)]}"
							  groups="pappaya_base.group_admission_admin,pappaya_base.group_admission_revenue_operation_assistant,pappaya_base.hr_deans,pappaya_base.hr_zonal_accountant
										pappaya_base.hr_branch_accountants"/> -->
						
						<field name="state" widget="statusbar" statusbar_visible="draft,request,approve,rejected,transfered"/>
					</header>
					<sheet>
						<group>
							<group>
								<field name="transfer_type" required="1" attrs="{'readonly':[('state','!=','draft')]}"/>
								<field name="school_id" attrs="{'readonly':[('state','!=','draft')]}" domain="[('type','=','branch')]" required="1" options="{'no_open': True,'no_create':True}"/>
								<field name="for_branch_id" domain="[('type','=','branch')]" attrs="{'readonly':[('state','!=','draft')],'required': [('transfer_type', '=', 'external')], 'invisible': [('transfer_type', '!=', 'external')]}" options="{'no_open': True,'no_create':True}"/>
								<field name="pappaya_student_id" required="1" attrs="{'readonly':[('state','!=','draft')]}" options="{'no_open': True,'no_create':True}"/>
							</group>
							<group>
								<field name="academic_year_id" readonly="1" options="{'no_open': True,'no_create':True}"/>
								<field name="current_date" readonly="1" string="Requested Date"/>
								<field name="father_name" readonly="1"/>
								<field name="medium_id" domain="[('type','=','medium')]" readonly="1" options="{'no_open': True,'no_create':True}"/>
								
							</group>
						</group>
						<group>
							<group string="From Course">
								<field name="from_course_id" required="1" readonly="1" options="{'no_open': True,'no_create':True}"/>
								<field name="from_group_id" required="1" readonly="1" options="{'no_open': True,'no_create':True}"/>
								<field name="from_batch_id" required="1" readonly="1" options="{'no_open': True,'no_create':True}"/>
								<field name="from_package_id" required="1" readonly="1" options="{'no_open': True,'no_create':True}"/>
								<field name="from_course_package_id" readonly="1" options="{'no_open': True,'no_create':True}" required="1"/>
								<field name="from_residential_type_id" readonly="1" options="{'no_open': True,'no_create':True}" />
								<field name="from_course_fee_total" readonly="1"/>
								<field name="from_course_fee_committed" invisible="1"/>
								<field name="from_course_fee_less" readonly="1" force_save="1"/>
								<field name="total_fee_paid" readonly="1"/>
								<field name="total_deductions" />
							</group>
							<group string="To Course">
								<field name="course_id" required="1" options="{'no_open': True,'no_create':True}" attrs="{'readonly':[('state','!=','draft')]}"/>
								<field name="group_id" required="1" options="{'no_open': True,'no_create':True}" attrs="{'readonly':[('state','!=','draft')]}"/>
								<field name="batch_id" required="1" options="{'no_open': True,'no_create':True}" attrs="{'readonly':[('state','!=','draft')]}"/>
								<field name="package_id" required="1" options="{'no_open': True,'no_create':True}" attrs="{'readonly':[('state','!=','draft')]}"/>
								<field name="to_residential_type_id" required="1" options="{'no_open': True,'no_create':True}" attrs="{'readonly':[('state','!=','draft')]}"/>
								<field name="course_package_id" options="{'no_open': True,'no_create':True}" required="1" attrs="{'readonly':[('state','!=','draft')]}"/>
								<field name="to_course_fee_total" readonly="1" force_save="1"/>
								<field name="to_course_fee_committed" invisible="1"/>
								<field name="to_course_fee_less" />
							</group>
						</group>						
						<group>
							<group>
								<field name="is_uniform_required" required="1" attrs="{'readonly':[('state','!=','draft')]}"/>
								<field name="is_nslate_required" invisible="1" attrs="{'readonly':[('state','!=','draft')]}"/>
								<field name="is_transport" invisible="1"/>
								<field name="is_uniform_fee_added" invisible="1"/>
							</group>
							<group>
								<field name="is_transport_required" required="1" attrs="{'readonly':[('state','!=','draft')], 'invisible':[('is_transport','=',False)]}"/>
								<field name="material_set_ids" widget="many2many_tags" domain="[('course_package_id','=',course_package_id),('academic_year_id','=',academic_year_id),('branch_id','=',for_branch_id)]" options="{'no_open': True,'no_create':True}"
									attrs="{'readonly':[('state','!=','draft')]}"/>
								<field name="material_amt" />
								
							</group>
						</group>
						<notebook>
							<page string="Deduction Details">
								<field name="student_transfer_deduction_line" attrs="{'readonly':['|',('state','!=','draft'),('is_refund_created','=',True)]}">
									<tree editable="bottom">
										<field name="deduction_head_id" options="{'no_create':True,'no_open':True}" required="1"/>
										<field name="amount" required="1" sum="Total"/>
										<field name="reason" required="1" />
									</tree>
								</field>
							</page>
							<page name="nslate_info" string="Nslate" attrs="{'invisible':[('is_nslate_required','=','no')], 'readonly':[('state','!=','draft')]}">
								<group>
									<field name="nslate_item_ids">
										<tree editable="bottom">
											<field name="sequence" widget="handle"/>
											<field name="product_id" options="{'no_open': True,'no_create':True}" required="1" domain="[('select_type','=','nslate')]"/>
											<field name="product_uom_qty" required="1"/>
											<field name="product_uom" invisible="1"/>
											<field name="price_unit" required="1"/>
											<field name="price_subtotal" readonly="1"/>
										</tree>
									</field>
									<group class="oe_subtotal_footer oe_right" colspan="2">
										<field name="nslate_amount"/>
									</group>
								</group>
							</page>
							
							<page name="transport_info" string="Transport" attrs="{'invisible':[('is_transport_required','=','no')]}">
								<group>
									<group>
										<field name="service_route_id" domain="[('is_active', '=', True)]"
										 attrs="{'invisible':[('is_transport_required','=','no')],'required':[('is_transport_required','!=','no')], 'readonly':[('state','!=','draft')]}" options="{'no_open': True,'no_create':True}"/>
									</group>
									<group>
										<field name="transport_slab_id" domain="[('route_id','=', service_route_id )]"
										 attrs="{'invisible':[('is_transport_required','=','no')],'required':[('is_transport_required','!=','no')],'readonly':[('state','!=','draft')]}" options="{'no_open': True,'no_create':True}"/>
									</group>
								</group>
							</page>							
							<page string="Fee Collection History">
								<field name="fee_collection_ids">
									<tree string ="Fees Collection" create="false" open="false" delete="false">
										<field name="name" readonly="1"/>
										<field name="gst_total" string="Amount" readonly="1"/>
										<field name="cgst" readonly="1" />
										<field name="sgst" readonly="1" />
										<field name="amount" string="Total" readonly="1" />
										<field name="res_adj_amt" readonly="1" sum="Total"/>
										<field name="concession_amount" readonly="1"/>
										<field name="due_amount" readonly="1" />
										<field name="total_paid" readonly="1" sum="Total Paid"/>
										<field name="term_state" readonly="1"/>
									</tree>
									<form>
										<field name="name" options="{'no_create':True,'no_open':True}" readonly="1"/>
										<field name="amount" readonly="1"/>
										<field name="total_paid" readonly="1"/>
									</form>
								</field>
							</page>
							<page string="Refund Details" attrs="{'invisible':[('is_create_refund','=',False)]}">
								<group>
									<group>
										<field name="total_refund_amount" readonly="1" force_save="1"/>
										<field name="is_create_refund" invisible="1"/>
										<field name="is_refund_created" invisible="1"/>
										<field name="excess_amount_move_to" required="1"/>
									</group>	
									<group>
										<field name="amount_transferable" readonly="1" force_save="1"/>
									</group>
								</group>
							</page>
						</notebook>
						<group>
							<field name="reason" placeholder="Add a transfer reason.." required="1" attrs="{'readonly':[('state','!=','draft')]}"/>
						</group>
					</sheet>
				</form>
			</field>
		</record>

		<record id="view_pappaya_student_transfer_search" model="ir.ui.view">
            <field name="name">pappaya.student.transfer.search</field>
            <field name="model">pappaya.student.transfer</field>
            <field name="priority" eval="8" />
            <field name="arch" type="xml">
                <search string="Student Transfer">
                    <field name="school_id" />
					<field name="pappaya_student_id" />
                    <newline />
                    <group expand="0" string="Group By...">
                        <filter string="State" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>

		<record model="ir.actions.act_window" id="act_open_pappaya_student_transfer_view">
			<field name="name">Transfer</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">pappaya.student.transfer</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
		</record>

	</data>
</odoo>
